{% extends 'base/base.html' %}

{% load static %}

{% block javascript %}
{{ block.super }}
<script src="{% static 'js/protocolo.js' %}"></script>
{% endblock %}

{% load django_bootstrap_breadcrumbs %}

{% block title %}Histórico{% endblock %}

{% block action %}
<div class="row">
	<div class="col-md-12 text-right mb-2">
	</div>
</div>
{% endblock %}
{% block body %}
	{% block breadcrumbs %}
		{% breadcrumb_safe "<i class='fas fa-home'></i>" "home" %}
		{% breadcrumb " Convênios " "convenios" %}
		{% breadcrumb " Histórico " "procolo" convenio.id %}
		{% render_breadcrumbs "django_bootstrap_breadcrumbs/bootstrap4.html" %}
	{% endblock %}

	<div class="mb-3">
		<div class="row">
			<div class="col-md-12">
				<div class="accordion" id="accordionDados">
					<div class="card">
						<div class="card-header p-0" id="headingDados">
							<h2 class="mb-0">
								<a class="btn btn-block text-left"
									data-toggle="collapse" 
									data-target="#collapseDados" 
									aria-expanded="true" 
									aria-controls="collapseDados"> Dados </a>
							</h2>
						</div>

						<div id="collapseDados" 
							class="collapse show" 
							aria-labelledby="headingDados" 
							data-parent="#accordionDados">
							<div class="card-body">
								<div class="row">
									<div class="col-md-6">
										<div class="form-group row mb-0">
											<label for="numero" class="col-sm-3 col-form-label-sm font-weight-bold">Nº Convênio</label>
											<div class="col-sm-8">
												<div class="form-control-sm form-control-plaintext">{{convenio.numero}}</div>
											</div>
										</div>
										<div class="form-group row mb-0">
											<label for="numero_proposta" class="col-sm-3 col-form-label-sm font-weight-bold">Nº Proposta</label>
											<div class="col-sm-8">
												<div class="form-control-sm form-control-plaintext">{{convenio.proposta.numero}}</div>
											</div>
										</div>
										<div class="form-group row mb-0">
											<label class="col-sm-3 col-form-label-sm font-weight-bold">Orgão</label>
											<div class="col-sm-8">
												<div class="form-control-sm form-control-plaintext">{{convenio.orgao}}</div>
											</div>
										</div>
										<div class="form-group row mb-0">
											<label class="col-sm-12 col-form-label-sm font-weight-bold">Objeto</label>
											<div class="col-sm-8">
												<div class="form-control-plaintext">{{convenio.proposta.objeto}}</div>
											</div>
										</div>
										<div class="form-group row mb-0">
											{% if convenio.data_suspensiva %}
											<label class="col-sm-3 col-form-label-sm font-weight-bold">Suspensiva</label>
											<div class="col-sm-3">
												<div class="form-control-sm form-control-plaintext">{{convenio.data_suspensiva|date:"d/m/Y"}}</div>
											</div>
											{% endif %}
											{% if convenio.data_vigencia %}
											<label class="col-sm-3 col-form-label-sm font-weight-bold">Vigência</label>
											<div class="col-sm-3">
												<div class="form-control-sm form-control-plaintext">{{convenio.data_vigencia|date:"d/m/Y"}}</div>
											</div>
											{% endif %}
										</div>
										<div class="form-group row mb-3">
											<label class="col-sm-12 col-form-label-sm font-weight-bold">Técnico do órgão</label>
											<div class="col-sm-12 ml-2">
												<div class="row">
													<div class="col-sm-3">
														<div class="form-control-sm form-control-plaintext">{{convenio.tecnico_orgao.telefone}}</div>
													</div>
													<div class="col-sm-6">
														<div class="form-control-sm form-control-plaintext">{{convenio.tecnico_orgao.nome}}</div>
													</div>
												</div>
											</div>
										</div>
									</div>
									<div class="col-md-6">
										<div class="row">
											<div class="col-md-12">
												<div class="accordion mb-3" id="accordionValores">
													<div class="card">
														<div class="card-header p-0" id="headingValores">
															<h2 class="mb-0">
																<a class="btn btn-block text-left" 
																	data-toggle="collapse" 
																	data-target="#collapseValores" 
																	aria-expanded="true" 
																	aria-controls="collapseValores"> Valores R$ </a>
															</h2>
														</div>

														<div id="collapseValores" 
															class="collapse show" 
															aria-labelledby="headingValores" 
															data-parent="#accordionValores">
															<div class="card-body">
																<div class="form-group row mb-0">
																	<label for="valor_convenio" class="col-sm-4 col-form-label-sm font-weight-bold">Convênio</label>
																	<div class="col-sm-8">
																		<div class="form-control-sm form-control-plaintext text-right">{{convenio.proposta.valor_convenio}}</div>
																	</div>
																</div>
																<div class="form-group row mb-0">
																	<label for="valor_contrapartida" class="col-sm-4 col-form-label-sm font-weight-bold">Contrapartida</label>
																	<div class="col-sm-8">
																		<div class="form-control-sm form-control-plaintext text-right">{{convenio.proposta.valor_contrapartida}}</div>
																	</div>
																</div>
																<div class="form-group row mb-0">
																	<label for="valor_repasse" class="col-sm-4 col-form-label-sm font-weight-bold">Repasse</label>
																	<div class="col-sm-8">
																		<div class="form-control-sm form-control-plaintext text-right">{{convenio.proposta.valor_repasse}}</div>
																	</div>
																</div>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>

										<div class="row">
											<div class="col-md-12">
												<div class="accordion" id="accordionDadosBancarios">
													<div class="card">
														<div class="card-header p-0" id="headingDadosBancarios">
															<h2 class="mb-0">
																<a class="btn btn-block text-left" 
																	data-toggle="collapse" 
																	data-target="#collapseDadosBancarios" 
																	aria-expanded="true" 
																	aria-controls="collapseDadosBancarios"> Dados bancários </a>
															</h2>
														</div>

														<div id="collapseDadosBancarios" 
															class="collapse show" 
															aria-labelledby="headingDadosBancarios" 
															data-parent="#accordionDadosBancarios">
															<div class="card-body">
																{% if convenio.banco %}
																<div class="row">
																	<label class="col-sm-3 col-form-label-sm font-weight-bold">Banco</label>
																	<div class="col-sm-7">
																		<div class="form-control-sm form-control-plaintext">
																		{% if convenio.banco %}{{convenio.banco}}{% endif %}
																		</div>
																	</div>
																</div>
																<div class="row">
																	<label class="col-sm-3 col-form-label-sm font-weight-bold">Agência</label>
																	<div class="col-sm-7">
																		<div class="form-control-sm form-control-plaintext">
																		{% if convenio.agencia %}{{convenio.agencia}}{% endif %}
																		</div>
																	</div>
																</div>
																<div class="row">
																	<label class="col-sm-3 col-form-label-sm font-weight-bold">Conta</label>
																	<div class="col-sm-7">
																		<div class="form-control-sm form-control-plaintext">
																		{% if convenio.conta %}{{convenio.conta}}{% endif %}
																		</div>
																	</div>
																</div>
																<a href="{% url 'protocolo_dados_bancarios' convenio.id %}" 
																	class="btn btn-block">
																	<i class="fas fa-pen"></i> Editar
																</a>
																{% else %}
																<a href="{% url 'protocolo_dados_bancarios' convenio.id %}" 
																	class="btn btn-block">
																	<i class="fas fa-plus"></i> Adicionar
																</a>
																{% endif %}
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="mb-3" class="accordion" id="accordionExecucaoOrcamentaria">
		<div class="card">
			<div class="card-header p-0" id="headingExecucaoOrcamentaria">
				<h2 class="mb-0">
					<a class="btn btn-block text-left" 
						data-toggle="collapse" 
						data-target="#collapseExecucaoOrcamentaria" 
						aria-expanded="true" 
						aria-controls="collapseExecucaoOrcamentaria"> Execução Orçamentária </a>
				</h2>
			</div>

			<div id="collapseExecucaoOrcamentaria" 
				class="collapse show" 
				aria-labelledby="headingExecucaoOrcamentaria" 
				data-parent="#accordionExecucaoOrcamentaria">
				<div class="row">
					<div class="col-md-12" id="accordionEmpresaContratada">
						<div class="card mx-3 mt-3 mb-3">
							<div class="card-header p-0" id="headingEmpresaContratada">
								<h2 class="mb-0">
									<a class="btn btn-block text-left" 
										data-toggle="collapse" 
										data-target="#collapseEmpresaContratada" 
										aria-expanded="true" 
										aria-controls="collapseEmpresaContratada"> Empresa contratada </a>
								</h2>
							</div>

							<div id="collapseEmpresaContratada" 
								class="collapse show" 
								aria-labelledby="headingEmpresaContratada" 
								data-parent="#accordionEmpresaContratada">
								<div class="card-body">
									<div class="row">
										<div class="col-md-12">
											{% if convenio.cnpj_empresa_contratada %}
											<div class="form-group row mb-0">
												{% if convenio.cnpj_empresa_contratada %}
												<label for="numero" class="col-sm-1 col-form-label-sm font-weight-bold">CNPJ</label>
												<div class="col-sm-2">
													<div class="form-control-sm form-control-plaintext">{{convenio.cnpj_empresa_contratada}}</div>
												</div>
												{% endif %}
												{% if convenio.nome_empresa_contratada %}
												<label for="numero_proposta" class="col-sm-1 col-form-label-sm font-weight-bold">Nome</label>
												<div class="col-sm-5">
													<div class="form-control-sm form-control-plaintext">{{convenio.nome_empresa_contratada}}</div>
												</div>
												{% endif %}
											</div>
											<div class="form-group row mb-0">
												{% if convenio.numero_contrato %}
												<label for="numero_proposta" class="col-sm-2 col-form-label-sm font-weight-bold">Nº contrato</label>
												<div class="col-sm-8">
													<div class="form-control-sm form-control-plaintext">{{convenio.numero_contrato}}</div>
												</div>
												{% endif %}
											</div>
											<div class="form-group row mb-0">
												{% if convenio.data_contrato %}
												<label for="numero_proposta" class="col-sm-2 col-form-label-sm font-weight-bold">Data contrato</label>
												<div class="col-sm-2">
													<div class="form-control-sm form-control-plaintext">{{convenio.data_contrato|date:"d/m/Y"}}</div>
												</div>
												{% endif %}
												{% if convenio.vigencia_contrato %}
												<label for="numero_proposta" class="col-sm-2 col-form-label-sm font-weight-bold">Vigência</label>
												<div class="col-sm-2">
													<div class="form-control-sm form-control-plaintext">{{convenio.vigencia_contrato|date:"d/m/Y"}}</div>
												</div>
												{% endif %}
											</div>
											<div class="form-group row mb-0">
												{% if convenio.valor_contrato %}
												<label for="numero_proposta" class="col-sm-1 col-form-label-sm font-weight-bold">Valor</label>
												<div class="col-sm-3">
													<div class="form-control-sm form-control-plaintext">{{convenio.valor_contrato}}</div>
												</div>
												{% endif %}
											</div>
											<a href="{% url 'protocolo_empresa_contratada' convenio.id %}" 
												class="btn btn-block">
												<i class="fas fa-pen"></i> Editar
											</a>
											{% else %}
											<a href="{% url 'protocolo_empresa_contratada' convenio.id %}" 
												class="btn btn-block">
												<i class="fas fa-plus"></i> Adicionar
											</a>
											{% endif %}
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!--
				<div class="row">
					<div class="col-md-12" id="accordionExecucaoConvenente">
						<div class="card mx-3 mt-3">
							<div class="card-header p-0" id="headingExecucaoConvenente">
								<h2 class="mb-0">
									<a class="btn btn-block text-left" 
										data-toggle="collapse" 
										data-target="#collapseExecucaoConvenente" 
										aria-expanded="true" 
										aria-controls="collapseExecucaoConvenente"> Execução convenente </a>
								</h2>
							</div>

							<div id="collapseExecucaoConvenente" 
								class="collapse show" 
								aria-labelledby="headingExecucaoConvenente" 
								data-parent="#accordionExecucaoConvenente">
								<div class="row">
									<div class="col-md-12">
										<table class="table table-bordered m-0 border-0">
											<thead>
												<tr>
													<th width="1%" class="border-left-0">Parcela</th>
													<th width="1%">Data</th>
													<th>Número</th>
													<th>Valor</th>
													<th width="1%" class="border-right-0">Percentual</th>
												</tr>
											</thead>
											<tbody>
												<tr>
													<td class="border-left-0">1ª</td>
													<td>01/09/2022</td>
													<td>02934</td>
													<td class="text-right">R$ 10.000,00</td>
													<td class="text-right border-right-0">30%</td>
												</tr>
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12" id="accordionExecucaoConcedente">
						<div class="card mx-3 mt-3 mb-4">
							<div class="card-header p-0" id="headingExecucaoConcedente">
								<h2 class="mb-0">
									<a class="btn btn-block text-left" 
										data-toggle="collapse" 
										data-target="#collapseExecucaoConcedente" 
										aria-expanded="true" 
										aria-controls="collapseExecucaoConcedente"> Execução concedente </a>
								</h2>
							</div>

							<div id="collapseExecucaoConcedente" 
								class="collapse show" 
								aria-labelledby="headingExecucaoConcedente" 
								data-parent="#accordionExecucaoConcedente">
								<div class="row">
									<div class="col-md-12">
										<table class="table table-bordered m-0 border-0">
											<thead>
												<tr>
													<th width="1%" class="border-left-0">Parcela</th>
													<th width="1%">Data</th>
													<th>Valor</th>
													<th width="1%" class="border-right-0">Percentual</th>
												</tr>
											</thead>
											<tbody>
												<tr>
													<td class="border-left-0">1ª</td>
													<td>01/09/2022</td>
													<td class="text-right">R$ 10.000,00</td>
													<td class="text-right border-right-0">30%</td>
												</tr>
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				-->
			</div>
		</div>
	</div>

	<div class="mb-4" id="accordionHistorico">
		<div class="card">
			<div class="card-header p-0" id="headingHistorico">
				<h2 class="mb-0">
					<a class="btn btn-block text-left" 
						data-toggle="collapse" 
						data-target="#collapseHistorico" 
						aria-expanded="true" 
						aria-controls="collapseHistorico"> Histórico </a>
				</h2>
			</div>

			<div id="collapseHistorico" 
				class="collapse show" 
				aria-labelledby="headingHistorico" 
				data-parent="#accordionHistorico">
				<div class="row">
					<div class="col-md-12">
						<table class="table table-bordered m-0 border-0">
							<thead>
								<tr>
									{% if perms.base.add_convenio %}
									<th width="1%" class="p-0 border-left-0">
										<a class="nav-link link-agiliza active mb-1" 
											href="{% url 'protocolos' convenio.id %}"> <i class="fas fa-plus"></i> </a>
									</th>
									{% else %}
									<th width="1%"><i class="fas fa-asterisk"></i></th>
									{% endif %}
									<th width="1%">Data</th>
									<th width="1%" style="white-space: nowrap;">Data prevista</th>
									<th>Responsável</th>
									<th>Considerações</th>
									<th width="1%" class="border-right-0">Anexo</th>
								</tr>
							</thead>
							{% if protocolos %}
							<tbody>
								{% for protocolo in protocolos %}
								<tr>
									<td class="text-center border-left-0">
										<ul class="navbar-nav mr-auto">
											<li class="nav-item dropdown text-center">
												<a href="javascript: void(0)" 
													class="nav-link link-agiliza dropdown-toggle p-0" 
													role="button" 
													data-toggle="dropdown" 
													aria-haspopup="true" 
													aria-expanded="false">
												{% if protocolo.situacao == 'resolvido' %}
													<i class="fas fa-check"></i>
												{% else %}
													<i class="fas fa-bars"></i>
												{% endif %}
												</a>
												<ul class="dropdown-menu">
													{% if protocolo.situacao != 'resolvido' %}
													<li>
														<a href="{% url 'protocolo_resolver' protocolo.id %}" 
															class="dropdown-item"> Resolver </a>
													</li>
													{% endif %}
													<li>
														<a href="javascript: void(0)" 
															class="dropdown-item" 
															data-href="{% url 'protocolo_excluir' protocolo.id %}" 
															onclick="excluir_protocolo(this)"> Excluir </a>
													</li>
												</ul>
											</li>
										</ul>
									</td>
									<td>{{ protocolo.data_protocolado|date:'d/m/Y' }}</td>
									<td>{{ protocolo.data_prevista|date:'d/m/Y' }}</td>
									<td>{{ protocolo.get_responsavel_display|default:"-" }}</td>
									<td>{{ protocolo.consideracoes }}</td>
									<td class="text-center border-right-0">
									{% if protocolo.anexo %}
										<a href="/media/{{ protocolo.anexo }}"><i class="fas fa-file-alt"></i></a>
									{% endif %}
									</td>
								</tr>
								{% endfor %}
							</tbody>
							{% else %}
							<tfoot>
								<tr>
									<td colspan="7">
										<div class="alert alert-info mb-0">Nenhum protocolo cadastrado!</div>
									</td>
								</tr>
							</tfoot>
							{% endif %}
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
{% endblock %}
